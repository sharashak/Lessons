<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="styles/style.css" rel="stylesheet" type="text/css" />
  <title>Сайт хороших новостей</title>
  <script>
    let dataRepo = { //Заведение объекта, в котором находятся все карточки с данными хранящихся новостей, и его свойств, которые этот объект имеет.
      getItem: () => {
        let string = localStorage.getItem('short-news')
        return JSON.parse(string) //Считывает строку в локальном хранилище для преобразования в массив, получает информацию из ЛС
      },

      setItem: (value) => {
        let json = JSON.stringify(value) //Преобразовывает массив в строку в локальном хранилище, помещает карточки в ЛС
        localStorage.setItem('short-news', json)
      },

      delete: (article) => { },

      create: (article) => { },

      getAllNews: () => {
        return dataRepo.getItem('short-news')
      }
    }

    //Определяем шаблон - в нашем случае это элемент списка с ссылкой, названием, описанием
    var newsItemTemplate =
      '<li>' +
      '<a class="short-news" href={url}>' +
      '<h2>{title}</h2>' +
      '<p>{description}</p>' +
      '</a>' +
      '</li>';

    //Уже знакомая нам функция инициализации, запускающая загрузку информации для шаблона, и выводящая всё на экран через функцию render()
    function init() {
      console.log("Инициализация - успешно") //Выводит сообщение в консоль, тем самым показывая, что страница загрузилась
      loadSampleData() //Функция, заполняющая массив карточками
      render() //Функция отображения содержимого наших карточек в документе HTML
    }

    function bindUserInputEvents() {
      let elements = document.querySelectorAll('data-id');
      console.log(elements)
      elements.forEach((el) => {
        el.addEventListener('change', (event) => {
          updateNewsAttributeById(el.getAttribute)("data-id")
        })
      });
    }

    //Заполняем наш репозиторий информацией о наших объектах
    function loadSampleData() { //Функция заполнения репозитория
      if (dataRepo.getItem("short-news") != null) { //Если репозиторий заполнен, вернуть значение, если пуст - пройти к выполнению setItem
        return
      }
      dataRepo.setItem([ //Помещаем массив в наш репозиторий
        {
          id: 1,
          title: "В новосибирском зоопарке родился медвежонок",
          description: "У престарелой пары белых медведей пополнение - фотки внутри",
          url: "bears.html"
        },
        {
          id: 2,
          title: "Путин сделал Навального президентом",
          description: "Путин принёс извинения за отравление в необычной форме",
          url: "navalny.html"
        },
        {
          id: 3,
          title: "Я купил кофе и молоко, чтобы пить кофе с молоком",
          description: "Кременкульское печенье отлично заходит с этим божественным напитком",
          url: "coffee.html"
        },
      ])
    }

    //Функция выводящая на экран информацию из карточек
    function render() {
      var html = ""; //Заводим переменную HTML, она пока пустая
      let articles = dataRepo.getAllNews()
      console.log(articles);
      //Заполняем наш HTML объектами из локального хранилища
      for (var i = 0; i < articles.length; i++) { //Заполняем шаблон HTML всеми новостями, которые у нас есть
        html += fillNewsTemplateWIthCardObject(articles[i]); //Добавляем в HTML 
      }
      //Возвращает массив всех элементов, относящихся к нашему классу .short-news
      let element = window.document.getElementsByClassName("short-news")[0];
      element.innerHTML = html
      //Как только элементы готовы, биндимся на них
      bindUserInputEvents()
    }

    //Заполняем шаблон и возвращаем его. Замена происходит поэтапно
    function fillNewsTemplateWIthCardObject(article) {
      return newsItemTemplate
        .replaceAll('{title}', article.title)
        .replaceAll('{item-id}', article.id)
        .replaceAll('{description}', article.description)
        .replaceAll('{url}', article.url)
    }
    //Страница загружена, вызываем всё, что нам нужно
    window.onload = (event) => {
      init();
    };

    /*  update: (article) => {
            let recentNews = dataRepo.getAllNews().map((el) => {
              if (el.id == article.id) {
                return article
              } else {
                return el
              }
            })
            dataRepo.setItem('short-news')
          }, */

 //эта функция заменяет выбранный атрибут новости на новый, который мы захотим. Обновляет одну новость, потому что находит элементы по id.
    //p.s. Дополнение от Евгения - “создается функция в которую помещается отфильтрованный массив всех наших новостей по айди который ты передал в функцию когда ее вызывал, далее у этой новости изменяется атрибут выбранный тобой (тайтл к примеру) и заменяется на то значения которое ты передал и апдейтится ЛС”
    /* function updateNewsAttributeById(id, title, description) {
      let findedNews = dataRepo.getAllNews().filter((el) => {
        return el.title == title
      })[0]
      findedCard[attribute] = value
      dataRepo.update(findedNews)
    } */
  </script>
</head>

<body>
  <div class="main-page-logo">
    <a class="home-button" href="index.html"><img class="logo-image" src="img/logo.jpg" alt="logo" />#ONLYGOODNEWS</h1>
    </a>
  </div>
  <div>
    <h2 class="motto-top">Все хорошие новости — в одном месте</h2>
  </div>
  <ul class="short-news">
  </ul>
  <h2 class="quote">#ONLYGOODNEWS makes your day perfect</h2>
  <footer class="motto-bottom">since MMXX <br> All Rights Reserved.</footer>
</body>

</html>