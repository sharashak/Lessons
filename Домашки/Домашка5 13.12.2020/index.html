<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="styles/style.css" rel="stylesheet" type="text/css" />
  <title>Сайт хороших новостей</title>
  <script>
    let dataRepo = {
      getItem: () => {
        let string = localStorage.getItem('short-news')
        return JSON.parse(string) //Считывает строку в локальном хранилище для преобразования в массив, получает информацию из ЛС
      },

      setItem: (value) => {
        let json = JSON.stringify(value) //Преобразовывает массив в строку в локальном хранилище, помещает карточки в ЛС
        localStorage.setItem('short-news', json)
      },

      delete: (article) => { },

      update: (article) => {
        let recentNews = dataRepo.getAllNews().map((el) => {
          if (el.id == article.id) {
            return article
          } else {
            return el
          }
        })
        dataRepo.setItem('short-news')
      },

      create: (article) => { },
      getAllNews: () => {
        return dataRepo.getItem('short-news')
      }
    }
    //Определяем шаблон - в нашем случае это элемент списка с ссылкой, названием, описанием
    var newsItemTemplate =
      '<li>' +
      '<a class="short-news" href={url}>' +
      '<h2>{title}</h2>' +
      '<p>{description}</p>' +
      '</a>' +
      '</li>';

    //Уже знакомая нам функция инициализации, запускающая загрузку информации для шаблона, и выводящая всё на экран через функцию render()
    function init() {
      console.log("Иницализация - успешно")

      loadSampleData()
      render()
    }

    function updateNewsAttributeById(id, attribute, value) {
      let findedNews = dataRepo.getAllNews().filter((el) => {
        return el.id == id
      })[0]
      findedCard[attribute] = value
      dataRepo.update(findedNews)
    }

    function bindUserInputEvents() {
      let elements = document.querySelectorAll('input');
      console.log(elements)
      elements.forEach((el) => {
        el.addEventListener('change', (event) => {
          updateNewsAttributeById(el.getAttribute)("data-id")
        })
      });
    }

    //Заполняем локальное хранилище информацией о наших объектах
    function loadSampleData() {
      if (dataRepo.getItem("short-news") != null) {
        return
      }
      dataRepo.setItem([
        {
          id: 1,
          title: "В новосибирском зоопарке родился медвежонок",
          description: "У престарелой пары белых медведей пополнение - фотки внутри",
          url: "bears.html"
        },
        {
          id: 2,
          title: "Путин сделал Навального президентом",
          description: "Путин принёс извинения за отравление в необычной форме",
          url: "navalny.html"
        },
        {
          id: 3,
          title: "Я купил кофе и молоко, чтобы пить кофе с молоком",
          description: "Кременкульское печенье отлично заходит с этим божественным напитком",
          url: "coffee.html"
        },
      ])
    }

    //Отображаем карточки
    function render() {
      var html = "";
      let article = dataRepo.getAllNews()
      console.log(article);
      //Заполняем наш HTML объектами из локального хранилища
      for (var i = 0; i < article.length; i++) {
        html += fillNewsTemplateWIthCardObject(article[i]);
      }
      //Возвращает массив всех элементов, относящихся к нашему классу .short-news
      let element = window.document.getElementsByClassName("short-news")[0];
      element.innerHTML = html

      //Как только элементы готовы, биндимся на них
      bindUserInputEvents()
    }

    //Заполняем шаблон и возвращаем его. Замена происходит поэтапно
    function fillNewsTemplateWIthCardObject(article) {
      return newsItemTemplate
        .replaceAll('{title}', article.title)
        .replaceAll('{item-id}', article.id)
        .replaceAll('{description}', article.description)
        .replaceAll('{url}', article.url)
    }
    //Страница загружена, вызываем всё, что нам нужно
    window.onload = (event) => {
      init();
    };
  </script>
</head>

<body>
  <div class="main-page-logo">
    <a class="home-button" href="index.html"><img class="logo-image" src="img/logo.jpg" alt="logo" />#ONLYGOODNEWS</h1>
    </a>
  </div>
  <div>
    <h2 class="motto-top">Все хорошие новости — в одном месте</h2>
  </div>
  <ul class="short-news">
  </ul>
  <h2 class="quote">#ONLYGOODNEWS makes your day perfect</h2>
  <footer class="motto-bottom">since MMXX <br> All Rights Reserved.</footer>
</body>

</html>